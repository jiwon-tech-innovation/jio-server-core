# JIAA Server Core - ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ²

## κ°μ”

`jiaa-server-core`λ” **ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ² (Ports and Adapters)**λ¥Ό μ μ©ν• Go μ„λ²„μ…λ‹λ‹¤.  
λΉ„μ¦λ‹μ¤ λ΅μ§μ„ μ™Έλ¶€ κΈ°μ (HTTP, gRPC, Kafka)λ΅λ¶€ν„° λ¶„λ¦¬ν•μ—¬ ν…μ¤νΈμ™€ μ μ§€λ³΄μκ°€ μ©μ΄ν•©λ‹λ‹¤.

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                        JIAA Server Core                         β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚   HTTP      β”‚    β”‚   Kafka     β”‚    β”‚   gRPC Server       β”‚  β”‚
β”‚  β”‚   Handler   β”‚    β”‚   Consumer  β”‚    β”‚   (Output)          β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚         β”‚                  β”‚                      β”‚             β”‚
β”‚         β–Ό                  β–Ό                      β–Ό             β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚                    PORT (IN)                             β”‚   β”‚
β”‚  β”‚  ReflexUseCase | StateReceiverUseCase | EmergencyUseCase β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                              β”‚                                  β”‚
β”‚                              β–Ό                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚                     SERVICE                              β”‚   β”‚
β”‚  β”‚   ReflexService | CommandRouterService | SolutionRouter  β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                              β”‚                                  β”‚
β”‚                              β–Ό                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚                     DOMAIN                               β”‚   β”‚
β”‚  β”‚   ClientActivity | CommandState | SabotageAction         β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                              β”‚                                  β”‚
β”‚                              β–Ό                                  β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚                    PORT (OUT)                            β”‚   β”‚
β”‚  β”‚  BlacklistPort | DataRelayPort | CommandPort | ...       β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                              β”‚                                  β”‚
β”‚         β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”             β”‚
β”‚         β–Ό                    β–Ό                    β–Ό             β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”     β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”     β”‚
β”‚  β”‚  Memory    β”‚     β”‚   Kafka    β”‚      β”‚  gRPC Client    β”‚     β”‚
β”‚  β”‚  Adapter   β”‚     β”‚  Producer  β”‚      β”‚  (Dev 1,3,5)    β”‚     β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”     β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
internal/
β”β”€β”€ input/                          # Input Service (λ°μ΄ν„° μμ‹  λ° νλ‹¨)
β”‚   β”β”€β”€ domain/                     # π― ν•µμ‹¬ λ„λ©”μΈ λ¨λΈ
β”‚   β”‚   β”β”€β”€ client_activity.go      # ν΄λΌμ΄μ–ΈνΈ ν™λ™ λ°μ΄ν„°
β”‚   β”‚   β”β”€β”€ command_state.go        # μƒνƒ λ…λ Ή (SLEEPING, THINKING λ“±)
β”‚   β”‚   β””β”€β”€ sabotage_action.go      # μ‚¬λ³΄νƒ€μ£Ό μ•΅μ… μ •μ
β”‚   β”‚
β”‚   β”β”€β”€ port/                       # π” ν¬νΈ μ •μ (μΈν„°νμ΄μ¤)
β”‚   β”‚   β”β”€β”€ in/                     # Driving Ports (μ™Έλ¶€ β†’ μ„λΉ„μ¤)
β”‚   β”‚   β”‚   β”β”€β”€ reflex_usecase.go
β”‚   β”‚   β”‚   β”β”€β”€ state_receiver_usecase.go
β”‚   β”‚   β”‚   β””β”€β”€ emergency_usecase.go
β”‚   β”‚   β””β”€β”€ out/                    # Driven Ports (μ„λΉ„μ¤ β†’ μ™Έλ¶€)
β”‚   β”‚       β”β”€β”€ blacklist_port.go
β”‚   β”‚       β”β”€β”€ data_relay_port.go
β”‚   β”‚       β”β”€β”€ command_port.go
β”‚   β”‚       β”β”€β”€ intelligence_port.go
β”‚   β”‚       β”β”€β”€ physical_control_port.go
β”‚   β”‚       β””β”€β”€ screen_control_port.go
β”‚   β”‚
β”‚   β”β”€β”€ service/                    # π’Ό λΉ„μ¦λ‹μ¤ λ΅μ§
β”‚   β”‚   β”β”€β”€ reflex_service.go       # λ°μ‚¬ μ‹ κ²½ (Blacklist μ¦‰κ° μ°¨λ‹¨)
β”‚   β”‚   β”β”€β”€ command_router_service.go
β”‚   β”‚   β”β”€β”€ solution_router_service.go
β”‚   β”‚   β””β”€β”€ emergency_service.go
β”‚   β”‚
β”‚   β””β”€β”€ adapter/                    # π”§ μ–΄λ‘ν„° κµ¬ν„μ²΄
β”‚       β”β”€β”€ in/                     # Driving Adapters
β”‚       β”‚   β”β”€β”€ http/handler.go     # REST API
β”‚       β”‚   β””β”€β”€ kafka/consumer.go   # Kafka Consumer
β”‚       β””β”€β”€ out/                    # Driven Adapters
β”‚           β”β”€β”€ grpc/               # gRPC Clients
β”‚           β”‚   β”β”€β”€ command_adapter.go
β”‚           β”‚   β”β”€β”€ intelligence_client.go
β”‚           β”‚   β”β”€β”€ physical_client.go
β”‚           β”‚   β””β”€β”€ screen_client.go
β”‚           β”β”€β”€ kafka/producer.go
β”‚           β””β”€β”€ memory/blacklist_adapter.go
β”‚
β””β”€β”€ output/                         # Output Service (λ…λ Ή μ‹¤ν–‰)
    β”β”€β”€ domain/
    β”β”€β”€ port/
    β”β”€β”€ service/
    β””β”€β”€ adapter/
```

---

## κ³„μΈµλ³„ μ„¤λ…

### 1. Domain (λ„λ©”μΈ)

λΉ„μ¦λ‹μ¤ ν•µμ‹¬ λ¨λΈ. μ™Έλ¶€ μμ΅΄μ„± μ—†μ.

| νμΌ | μ„¤λ… |
|------|------|
| `client_activity.go` | Dev 1/2μ—μ„ μμ‹ ν• μ„Όμ„ λ°μ΄ν„° |
| `command_state.go` | Dev 6μ—μ„ μμ‹ ν• μƒνƒ (SLEEPING, EMERGENCY λ“±) |
| `sabotage_action.go` | μ‚¬λ³΄νƒ€μ£Ό λ…λ Ή (λ§μ°μ¤ κ°λ„, ν™”λ©΄ ν”λ“¤κΈ° λ“±) |

### 2. Port (ν¬νΈ)

μΈν„°νμ΄μ¤ μ •μ. κµ¬ν„μ²΄λ” Adapterμ—μ„ μ κ³µ.

**Driving Ports (In)** - μ™Έλ¶€μ—μ„ μ„λΉ„μ¤ νΈμ¶
```go
type ReflexUseCase interface {
    ProcessActivity(activity ClientActivity) error
}
```

**Driven Ports (Out)** - μ„λΉ„μ¤κ°€ μ™Έλ¶€ νΈμ¶
```go
type IntelligencePort interface {
    RequestLogAnalysis(clientID, errorLog, screamText string) (string, error)
    RequestURLClassification(clientID, url, title string) (string, error)
}
```

### 3. Service (μ„λΉ„μ¤)

λΉ„μ¦λ‹μ¤ λ΅μ§. Port μΈν„°νμ΄μ¤μ— μμ΅΄.

| μ„λΉ„μ¤ | μ—­ν•  |
|--------|------|
| `ReflexService` | Blacklist μ²΄ν¬ β†’ μ¦‰κ° Sabotage |
| `CommandRouterService` | μƒνƒμ— λ”°λ¥Έ λ…λ Ή λ¶„λ°° |
| `SolutionRouterService` | AI κ²°κ³Όλ¥Ό Dev 3μ—κ² μ „λ‹¬ |
| `EmergencyService` | Emergency ν”„λ΅ν† μ½ μ²λ¦¬ |

### 4. Adapter (μ–΄λ‘ν„°)

Port μΈν„°νμ΄μ¤ κµ¬ν„μ²΄.

| μ–΄λ‘ν„° | ν¬νΈ | κΈ°μ  |
|--------|------|------|
| `http/handler.go` | ReflexUseCase | Echo (REST) |
| `kafka/consumer.go` | StateReceiverUseCase | Kafka |
| `grpc/intelligence_client.go` | IntelligencePort | gRPC β†’ Dev 5 |
| `grpc/screen_client.go` | ScreenControlPort | gRPC β†’ Dev 3 |
| `memory/blacklist_adapter.go` | BlacklistPort | In-Memory |

---

## λ°μ΄ν„° νλ¦„ μμ‹

### 1. URL μ°¨λ‹¨ (Reflex)

```
HTTP Request β†’ handler.go β†’ ReflexService β†’ BlacklistAdapter (μ²΄ν¬)
                                    β†“
                              SabotageCommandAdapter β†’ Dev 1/3
```

### 2. Emergency ν”„λ΅ν† μ½

```
Kafka (EMERGENCY) β†’ StateConsumer β†’ CommandRouterService
                                           β†“
                                    IntelligenceAdapter β†’ Dev 5 (AI λ¶„μ„)
                                           β†“
                                    SolutionRouterService β†’ Dev 3 (κ²°κ³Ό ν‘μ‹)
```

---

## μ¥μ 

1. **ν…μ¤νΈ μ©μ΄μ„±**: Port μΈν„°νμ΄μ¤λ΅ Mock μ£Όμ… κ°€λ¥
2. **κΈ°μ  λ…λ¦½μ„±**: gRPC β†’ REST λ³€κ²½ μ‹ Adapterλ§ κµμ²΄
3. **λ…ν™•ν• κ²½κ³„**: κ° κ³„μΈµμ μ±…μ„μ΄ λ¶„λ…ν•¨
4. **λ³‘λ ¬ κ°λ°**: ν¬νΈ μ •μ ν›„ μ„λΉ„μ¤/μ–΄λ‘ν„° λ…λ¦½ κ°λ° κ°€λ¥
